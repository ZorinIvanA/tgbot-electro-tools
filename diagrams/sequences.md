# Диаграмы последовательности
## Без ИИ (машина состояний)
```mermaid
sequenceDiagram
    actor Пользователь
    participant Бот
    participant БД as База данных (FSM)

    Пользователь->>Бот: Привет! У меня проблема с оплатой.
    Бот->>БД: Получить текущее состояние сессии
    БД-->>Бот: Состояние: "ожидание выбора темы"
    Бот->>Пользователь: Выберите тему: 1) Оплата, 2) Доставка, 3) Возврат
    Пользователь->>Бот: 1
    Бот->>БД: Обновить состояние → "оплата: уточнение ошибки"
    БД-->>Бот: OK
    Бот->>Пользователь: Какая ошибка появляется? Пришлите скриншот.
    Пользователь->>Бот: [скриншот]
    Бот->>БД: Сохранить обращение, завершить сессию
    Бот->>Пользователь: Спасибо! Оператор свяжется в течение часа.
```

## С ИИ для распознавания запроса пользователя
```mermaid
sequenceDiagram
    actor Пользователь
    participant Бот
    participant AI as Bothub.ru (AI)
    participant БД as База данных (сценарии)

    Пользователь->>Бот: Не могу оплатить заказ!
    Бот->>AI: Проанализируй текст: "Не могу оплатить заказ!"
    AI-->>Бот: intent=payment_issue, entities={ }
    Бот->>БД: Найти сценарий для intent=payment_issue
    БД-->>Бот: Сценарий: "Оплата → запрос деталей"
    Бот->>Пользователь: Уточните, пожалуйста: карта не проходит или ошибка на сайте?
    Пользователь->>Бот: Карта не проходит, пишет "отказ банка".
    Бот->>БД: Сохранить обращение по сценарию "payment_issue"
    Бот->>Пользователь: Мы передали данные в банк. Ответ пришлют на email в течение 2 часов.
```
