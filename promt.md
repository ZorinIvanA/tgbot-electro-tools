# Telegram Bot –¥–ª—è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ü–æ–¥–¥–µ—Ä–∂–∫–∏ –≠–ª–µ–∫—Ç—Ä–æ–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

## üîß –û–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞

Telegram-–±–æ—Ç –¥–ª—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —ç–ª–µ–∫—Ç—Ä–æ–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–£–®–ú, –¥—Ä–µ–ª–∏, —Ç–æ—Ä—Ü–æ–≤–æ—á–Ω—ã–µ –ø–∏–ª—ã –∏ —Ç.–¥.). –ë–æ—Ç —Ä–∞–∑–º–µ—â–∞–µ—Ç—Å—è –ø–æ QR-–∫–æ–¥—É –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–µ —Ç–æ–≤–∞—Ä–∞ –≤ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ –∏ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–∏. –ü–æ—Å–ª–µ –∑–∞–¥–∞–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –±–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.

## üì¶ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Go 1.25** - –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫
- **PostgreSQL 15+** - –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **Telegram Bot API v5** - –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Telegram
- **Docker** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- **Prometheus** - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ bot/
‚îÇ       ‚îî‚îÄ‚îÄ main.go       # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ bot/              # –õ–æ–≥–∏–∫–∞ Telegram –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ fsm/              # –ö–æ–Ω–µ—á–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–∏–∞–ª–æ–≥–∞
‚îÇ   ‚îú‚îÄ‚îÄ storage/          # –†–∞–±–æ—Ç–∞ —Å PostgreSQL
‚îÇ   ‚îú‚îÄ‚îÄ metrics/          # –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus
‚îÇ   ‚îî‚îÄ‚îÄ api/              # HTTP API –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ migrations/           # SQL-–º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ Dockerfile            # –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ .env.example          # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ README.md             # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îî‚îÄ‚îÄ promt.md              # –î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å –ø–æ–ª–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º
```

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Go 1.25+
- PostgreSQL 15+
- Docker (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
   ```bash
   git clone https://github.com/ZorinIvanA/tgbot-electro-tools.git
   cd tgbot-electro-tools
   ```

2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö**
   ```bash
   createdb electro_tools_bot
   psql -d electro_tools_bot -f migrations/001_create_initial_schema.sql
   ```

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
   ```bash
   cp .env.example .env
   # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env —Ñ–∞–π–ª
   ```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç—å**
   ```bash
   go run cmd/bot/main.go
   ```

### Docker –∑–∞–ø—É—Å–∫

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t telegram-electro-tools-bot .

# –ó–∞–ø—É—Å–∫ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
docker run -p 8080:8080 --env-file .env telegram-electro-tools-bot
```

## üìä –ú–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π (FSM)

### –¢–∏–ø—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π

```go
const (
    StateIdle                    State = "idle"
    StateUSHMNotStartingStep1   State = "ushm_not_starting_step1"
    StateUSHMNotStartingStep2   State = "ushm_not_starting_step2"
    StateAwaitingEmail          State = "awaiting_email"
    StateAwaitingEmailConsent    State = "awaiting_email_consent"
    StateOfferingSiteLink       State = "offering_site_link"
    StateOfferingSitePost       State = "offering_site_post"
)
```

### –°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

- –£–≥–ª–æ–≤–∞—è —à–ª–∏—Ñ–æ–≤–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ (–£–®–ú)
- –¢–æ—Ä—Ü–æ–≤–æ—á–Ω–∞—è –ø–∏–ª–∞
- –≠–ª–µ–∫—Ç—Ä–æ–ª–æ–±–∑–∏–∫
- –ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä–Ω—ã–π —à—É—Ä—É–ø–æ–≤—ë—Ä—Ç
- –ü—Ä–æ–≤–æ–¥–Ω–∞—è –≥–∞–∑–æ–Ω–æ–∫–æ—Å–∏–ª–∫–∞

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Ü–µ–ø–æ—á–∫–∏

–ö–∞–∂–¥–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏–º–µ–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –∫–æ—Ä–Ω–µ–≤—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–º–∏ —à–∞–≥–∞–º–∏:

1. **Root State**: –í—ã–±–æ—Ä –ø—Ä–æ–±–ª–µ–º—ã
2. **–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —à–∞–≥–∏**: –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –¥–µ–π—Å—Ç–≤–∏—è
3. **Terminal Actions**: –§–∏–Ω–∞–ª—å–Ω—ã–µ —à–∞–≥–∏ —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏

### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –£–®–ú:

1. **–®–∞–≥ 1**: –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–ø—É—Å–∫–æ–º
2. **–®–∞–≥ 2**: –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (—Ä–æ–∑–µ—Ç–∫–∞, –ø—Ä–µ–¥–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å, –∫–∞–±–µ–ª—å, —à–ø–∏–Ω–¥–µ–ª—å)
3. **–®–∞–≥ 3**: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ç–µ—Ö–æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—é

### –°—Ü–µ–Ω–∞—Ä–∏–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

–ö–∞–∂–¥—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–±–æ—Ä —à–∞–≥–æ–≤ –∏ —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π:

#### –£–≥–ª–æ–≤–∞—è —à–ª–∏—Ñ–æ–≤–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞
- **no_power** - —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è
- **stopped_during_operation** - –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã  
- **Action steps** - —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

#### –¢–æ—Ä—Ü–æ–≤–æ—á–Ω–∞—è –ø–∏–ª–∞
- **no_power** - —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è
- **motor_runs_no_blade_rotation** - –º–æ—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –¥–∏—Å–∫ –Ω–µ –≤—Ä–∞—â–∞–µ—Ç—Å—è
- **vibration_or_inaccurate_cut** - –≤–∏–±—Ä–∞—Ü–∏—è –∏–ª–∏ –Ω–µ—Ç–æ—á–Ω—ã–π —Ä–µ–∑

#### –≠–ª–µ–∫—Ç—Ä–æ–ª–æ–±–∑–∏–∫
- **no_power** - —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è
- **blade_not_moving** - –ø–æ–ª–æ—Ç–Ω–æ –Ω–µ –¥–≤–∏–∂–µ—Ç—Å—è
- **excessive_vibration_or_drift** - —Å–∏–ª—å–Ω–∞—è –≤–∏–±—Ä–∞—Ü–∏—è –∏–ª–∏ —É–≤–æ–¥

#### –ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä–Ω—ã–π —à—É—Ä—É–ø–æ–≤—ë—Ä—Ç
- **no_power** - —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è
- **spins_but_no_torque** - –≤—Ä–∞—â–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –∫—Ä—É—Ç–∏—Ç
- **battery_drains_quickly** - –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä –±—ã—Å—Ç—Ä–æ —Å–∞–¥–∏—Ç—Å—è

#### –ü—Ä–æ–≤–æ–¥–Ω–∞—è –≥–∞–∑–æ–Ω–æ–∫–æ—Å–∏–ª–∫–∞
- **no_power** - —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è
- **motor_runs_no_blade_rotation** - –º–æ—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–æ–∂ –Ω–µ –≤—Ä–∞—â–∞–µ—Ç—Å—è
- **uneven_cut_or_vibration** - –Ω–µ—Ä–æ–≤–Ω—ã–π —Å—Ä–µ–∑ –∏–ª–∏ –≤–∏–±—Ä–∞—Ü–∏—è

## üì° –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã API

### HTTP API (–¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |
|-------|------|----------|----------------|
| GET | `/api/v1/metrics` | –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ Prometheus | –ù–µ—Ç |
| GET | `/api/v1/settings` | –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ | Bearer token |
| PUT | `/api/v1/settings` | –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ | Bearer token |
| GET | `/health` | Health check | –ù–µ—Ç |

### GET /api/v1/metrics - –≠–∫—Å–ø–æ—Ä—Ç –º–µ—Ç—Ä–∏–∫ Prometheus

–≠–∫—Å–ø–æ—Ä—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ Prometheus –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–∏—Å—Ç–µ–º—ã.

**–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏:**
- `telegram_bot_active_users_total{period="24h"}` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∑–∞ 24 —á–∞—Å–∞
- `telegram_bot_messages_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
- `telegram_bot_fsm_state{state="idle"}` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º FSM

### GET /api/v1/settings - –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞.

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "trigger_message_count": 5,
  "site_url": "https://example.com"
}
```

### PUT /api/v1/settings - –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–û–±–Ω–æ–≤–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞.

**–ü—Ä–∏–º–µ—Ä —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "trigger_message_count": 5,
  "site_url": "https://example.com"
}
```

### GET /health - Health check

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞.

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "status": "ok"
}
```

## üìë –ú–∏–≥—Ä–∞—Ü–∏–∏ (–û–¥–Ω–∞ —Ñ–∞–π–ª–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –ø—É—Å—Ç–æ–π –±–∞–∑—ã)

–í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –Ω—É–ª—è:

```sql
-- 001_create_initial_schema.sql
-- Initial database schema for Telegram bot

-- Settings table (single row configuration)
CREATE TABLE IF NOT EXISTS settings (
    id SERIAL PRIMARY KEY,
    trigger_message_count INT NOT NULL DEFAULT 3,
    site_url TEXT NOT NULL DEFAULT 'https://example.com',
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Insert default settings
INSERT INTO settings (trigger_message_count, site_url)
VALUES (3, 'https://example.com')
ON CONFLICT (id) DO NOTHING;

-- Users table
CREATE TABLE IF NOT EXISTS users (
    id BIGSERIAL PRIMARY KEY,
    telegram_id BIGINT NOT NULL UNIQUE,
    username TEXT,
    first_name TEXT,
    last_name TEXT,
    message_count INT NOT NULL DEFAULT 0,
    fsm_state TEXT NOT NULL DEFAULT 'idle',
    email TEXT,
    consent_granted BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Create index on telegram_id for faster lookups
CREATE INDEX IF NOT EXISTS idx_users_telegram_id ON users(telegram_id);

-- Create index on fsm_state for metrics
CREATE INDEX IF NOT EXISTS idx_users_fsm_state ON users(fsm_state);

-- Messages log table (for metrics and debugging)
CREATE TABLE IF NOT EXISTS messages (
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL REFERENCES users(telegram_id) ON DELETE CASCADE,
    message_text TEXT,
    direction TEXT NOT NULL CHECK (direction IN ('incoming', 'outgoing')),
    created_at TIMESTAMP DEFAULT NOW()
);

-- Create index on created_at for time-based queries (24h metrics)
CREATE INDEX IF NOT EXISTS idx_messages_created_at ON messages(created_at);
CREATE INDEX IF NOT EXISTS idx_messages_user_id ON messages(user_id);

-- Rate limiting table (stores last message timestamps)
CREATE TABLE IF NOT EXISTS rate_limits (
    telegram_id BIGINT PRIMARY KEY,
    message_timestamps BIGINT[], -- Array of Unix timestamps
    updated_at TIMESTAMP DEFAULT NOW()
);

-- –°—Ü–µ–Ω–∞—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "—É—à–º_–Ω–µ_–≤–∫–ª—é—á–∞–µ—Ç—Å—è")
CREATE TABLE IF NOT EXISTS fsm_scenarios (
    id SERIAL PRIMARY KEY,
    name TEXT UNIQUE NOT NULL,          -- "ushm_not_starting"
    display_name TEXT,                  -- "–£–≥–ª–æ–≤–∞—è —à–ª–∏—Ñ–æ–≤–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞"
    trigger_keywords TEXT[] NOT NULL,   -- ["–Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è", "–º–æ–ª—á–∏—Ç"]
    description TEXT                     -- –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
);

-- –®–∞–≥–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è
CREATE TABLE IF NOT EXISTS fsm_steps (
    id SERIAL PRIMARY KEY,
    scenario_id INT REFERENCES fsm_scenarios(id) ON DELETE CASCADE,
    step_key TEXT NOT NULL,             -- "step1", "step2"
    message TEXT NOT NULL,              -- —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç–∞
    is_final BOOL DEFAULT false,
    next_step_key TEXT,                 -- NULL = –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
    UNIQUE(scenario_id, step_key)
);

-- –°–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
CREATE TABLE IF NOT EXISTS user_sessions (
    user_id BIGINT PRIMARY KEY,
    current_scenario_id INT REFERENCES fsm_scenarios(id),
    current_step_key TEXT,
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö FSM (–µ—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è)
-- –£—á–∏—Ç—ã–≤–∞–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ –∫–ª—é—á–∞: —Å–Ω–∞—á–∞–ª–∞ –¥–æ—á–µ—Ä–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã, –∑–∞—Ç–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ
TRUNCATE TABLE user_sessions CASCADE;
TRUNCATE TABLE fsm_steps CASCADE;
TRUNCATE TABLE fsm_scenarios CASCADE;

-- –°–±—Ä–æ—Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π ID –¥–ª—è —Ç–∞–±–ª–∏—Ü FSM
ALTER SEQUENCE fsm_scenarios_id_seq RESTART WITH 1;
ALTER SEQUENCE fsm_steps_id_seq RESTART WITH 1;

-- –í—Å—Ç–∞–≤–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –£–®–ú
INSERT INTO fsm_scenarios (name, display_name, trigger_keywords, description) VALUES
('diagnose_angle_grinder', '–£–≥–ª–æ–≤–∞—è —à–ª–∏—Ñ–æ–≤–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞', ARRAY['—É–≥–ª–æ–≤–∞—è —à–ª–∏—Ñ–æ–≤–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞', '–±–æ–ª–≥–∞—Ä–∫–∞', '—É—à–º', 'angle grinder'], '–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —É–≥–ª–æ–≤–æ–π —à–ª–∏—Ñ–æ–≤–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã'),
('diagnose_miter_saw', '–¢–æ—Ä—Ü–æ–≤–æ—á–Ω–∞—è –ø–∏–ª–∞', ARRAY['—Ç–æ—Ä—Ü–æ–≤–æ—á–Ω–∞—è –ø–∏–ª–∞', '—Ç–æ—Ä—Ü–æ–≤–∫–∞', 'miter saw'], '–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç–æ—Ä—Ü–æ–≤–æ—á–Ω–æ–π –ø–∏–ª—ã'),
('diagnose_jigsaw', '–≠–ª–µ–∫—Ç—Ä–æ–ª–æ–±–∑–∏–∫', ARRAY['—ç–ª–µ–∫—Ç—Ä–æ–ª–æ–±–∑–∏–∫', '–ª–æ–±–∑–∏–∫', 'jigsaw'], '–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —ç–ª–µ–∫—Ç—Ä–æ–ª–æ–±–∑–∏–∫–∞'),
('diagnose_cordless_drill', '–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä–Ω—ã–π —à—É—Ä—É–ø–æ–≤—ë—Ä—Ç', ARRAY['–∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–Ω—ã–π —à—É—Ä—É–ø–æ–≤—ë—Ä—Ç', '—à—É—Ä—É–ø–æ–≤—ë—Ä—Ç', 'cordless screwdriver'], '–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–Ω–æ–≥–æ —à—É—Ä—É–ø–æ–≤—ë—Ä—Ç–∞'),
('diagnose_corded_lawnmower', '–ü—Ä–æ–≤–æ–¥–Ω–∞—è (—Å–µ—Ç–µ–≤–∞—è) –≥–∞–∑–æ–Ω–æ–∫–æ—Å–∏–ª–∫–∞', ARRAY['–ø—Ä–æ–≤–æ–¥–Ω–∞—è –≥–∞–∑–æ–Ω–æ–∫–æ—Å–∏–ª–∫–∞', '–≥–∞–∑–æ–Ω–æ–∫–æ—Å–∏–ª–∫–∞', 'lawn mower'], '–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–≤–æ–¥–Ω–æ–π –≥–∞–∑–æ–Ω–æ–∫–æ—Å–∏–ª–∫–∏');

-- –í—Å—Ç–∞–≤–∫–∞ —à–∞–≥–æ–≤ –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è "diagnose_angle_grinder"
INSERT INTO fsm_steps (scenario_id, step_key, message, is_final, next_step_key) VALUES
-- Root state: diagnose_angle_grinder
(1, 'root', '–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —É–≥–ª–æ–≤–æ–π —à–ª–∏—Ñ–æ–≤–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É:', false, NULL),

-- no_power branch
(1, 'no_power', '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. –ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä —Ä–∞–∑—Ä—è–∂–µ–Ω
2. –ó–∞–ª–∏–ø–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –ø—É—Å–∫–∞
3. –û–±—Ä—ã–≤ –ø—Ä–æ–≤–æ–¥–∞
4. –°–≥–æ—Ä–µ–ª –¥–≤–∏–≥–∞—Ç–µ–ª—å', false, 'no_power_action'),

(1, 'no_power_action', '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:', false, NULL),

-- stopped_during_operation branch
(1, 'stopped_during_operation', '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å –≤–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. –ó–∞—â–∏—Ç–∞ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–∞ —Å—Ä–∞–±–æ—Ç–∞–ª–∞
2. –ü–æ–ª–Ω—ã–π —Ä–∞–∑—Ä—è–¥
3. –ü–µ—Ä–µ–≥—Ä–µ–≤ –¥–≤–∏–≥–∞—Ç–µ–ª—è
4. –ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–∫–ª–∏–Ω–∏–≤–∞–Ω–∏–µ
5. –ò–∑–Ω–æ—Å —É–≥–æ–ª—å–Ω—ã—Ö —â—ë—Ç–æ–∫
6. –ù–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç—å —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∏', false, 'stopped_action'),

(1, 'stopped_action', '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:', false, NULL);

-- Terminal actions for angle grinder
INSERT INTO fsm_steps (scenario_id, step_key, message, is_final, next_step_key) VALUES
(1, 'charge_or_replace_battery', 'üîã –ó–∞—Ä—è–¥–∏—Ç—å –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç—å –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä:

1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∑–∞—Ä—è–¥–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
2. –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ–ª–Ω–æ–π –∑–∞—Ä—è–¥–∫–∏ (–æ–±—ã—á–Ω–æ 1-2 —á–∞—Å–∞)
3. –ï—Å–ª–∏ –Ω–µ –∑–∞—Ä—è–∂–∞–µ—Ç—Å—è - –∑–∞–º–µ–Ω–∏—Ç–µ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä

–ü–æ—Å–ª–µ –∑–∞—Ä—è–¥–∫–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç.', true, NULL),

(1, 'replace_trigger_button', 'üîò –ó–∞–º–µ–Ω–∏—Ç—å –∫–Ω–æ–ø–∫—É –ø—É—Å–∫–∞:

1. –†–∞–∑–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–ø—É—Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
2. –ò–∑–≤–ª–µ–∫–∏—Ç–µ —Å—Ç–∞—Ä—É—é –∫–Ω–æ–ø–∫—É
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–æ–≤—É—é –∫–Ω–æ–ø–∫—É
4. –°–æ–±–µ—Ä–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç

–ë—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã —Å —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–º–∏ –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏.', true, NULL),

(1, 'repair_internal_wiring', 'üîå –†–µ–º–æ–Ω—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –ø—Ä–æ–≤–æ–¥–∫–∏:

1. –†–∞–∑–±–µ—Ä–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
2. –ù–∞–π–¥–∏—Ç–µ –º–µ—Å—Ç–æ –æ–±—Ä—ã–≤–∞ (—á–∞—Å—Ç–æ —É —Ä–∞–∑—ä—ë–º–∞ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–∞)
3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞–π–∫—É –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç–µ –ø—Ä–æ–≤–æ–¥
4. –ò–∑–æ–ª–∏—Ä—É–π—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

–¢—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞–≤—ã–∫ –ø–∞–π–∫–∏.', true, NULL),

(1, 'refer_to_service_center', 'üè™ –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Ü–µ–Ω—Ç—Ä:

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–ª—è:
- –°–≥–æ—Ä–µ–≤—à–µ–≥–æ –¥–≤–∏–≥–∞—Ç–µ–ª—è
- –ù–µ–∏—Å–ø—Ä–∞–≤–Ω–æ–π —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∏
- –°–ª–æ–∂–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª–æ–º–æ–∫

–í–æ–∑—å–º–∏—Ç–µ —Å —Å–æ–±–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏ –∑–∞—Ä—è–¥–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.', true, NULL),

(1, 'restart_after_protection_reset', 'üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞ –∑–∞—â–∏—Ç—ã:

1. –û—Ç–∫–ª—é—á–∏—Ç–µ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä
2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã
3. –ü–æ–≤—Ç–æ—Ä–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä.', true, NULL),

(1, 'restart_after_cooling', '‚ùÑÔ∏è –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è:

1. –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
2. –î–∞–π—Ç–µ –æ—Å—Ç—ã—Ç—å 15-30 –º–∏–Ω—É—Ç
3. –ü–æ–≤—Ç–æ—Ä–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å

–ò–∑–±–µ–≥–∞–π—Ç–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ.', true, NULL),

(1, 'repair_mechanical_drive', '‚öôÔ∏è –†–µ–º–æ–Ω—Ç –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–≤–æ–¥–∞:

1. –†–∞–∑–±–µ—Ä–∏—Ç–µ —Ä–µ–¥—É–∫—Ç–æ—Ä
2. –û—Å–º–æ—Ç—Ä–∏—Ç–µ —à–µ—Å—Ç–µ—Ä–Ω–∏ –∏ –ø–æ–¥—à–∏–ø–Ω–∏–∫–∏
3. –ó–∞–º–µ–Ω–∏—Ç–µ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–µ –¥–µ—Ç–∞–ª–∏
4. –°–º–∞–∂—å—Ç–µ –º–µ—Ö–∞–Ω–∏–∑–º

–¢—Ä–µ–±—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç.', true, NULL),

(1, 'replace_carbon_brushes', 'üñäÔ∏è –ó–∞–º–µ–Ω–∞ —É–≥–æ–ª—å–Ω—ã—Ö —â—ë—Ç–æ–∫:

1. –†–∞–∑–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–ø—É—Å
2. –ò–∑–≤–ª–µ–∫–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ —â—ë—Ç–∫–∏
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–æ–≤—ã–µ —â—ë—Ç–∫–∏
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç —Å –∫–æ–ª–ª–µ–∫—Ç–æ—Ä–æ–º

–©—ë—Ç–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º–∏.', true, NULL);

-- –í—Å—Ç–∞–≤–∫–∞ —à–∞–≥–æ–≤ –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è "diagnose_miter_saw"
INSERT INTO fsm_steps (scenario_id, step_key, message, is_final, next_step_key) VALUES
-- Root state
(2, 'root', '–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç–æ—Ä—Ü–æ–≤–æ—á–Ω–æ–π –ø–∏–ª—ã. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É:', false, NULL),

-- no_power branch
(2, 'no_power', '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. –ù–µ—Ç –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è
2. –û–±—Ä—ã–≤ –∫–∞–±–µ–ª—è
3. –ê–∫—Ç–∏–≤–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—É—Å–∫–∞
4. –°–≥–æ—Ä–µ–ª –¥–≤–∏–≥–∞—Ç–µ–ª—å/–∫–æ–Ω–¥–µ–Ω—Å–∞—Ç–æ—Ä', false, 'no_power_action'),

(2, 'no_power_action', '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:', false, NULL),

-- motor_runs_no_blade_rotation branch
(2, 'motor_runs_no_blade_rotation', '–ú–æ—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –¥–∏—Å–∫ –Ω–µ –≤—Ä–∞—â–∞–µ—Ç—Å—è. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. –ö–ª–∏–Ω —à–ø–∏–Ω–¥–µ–ª—è
2. –û–±—Ä—ã–≤ —Ä–µ–º–Ω—è', false, 'motor_no_blade_action'),

(2, 'motor_no_blade_action', '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:', false, NULL),

-- vibration_or_inaccurate_cut branch
(2, 'vibration_or_inaccurate_cut', '–í–∏–±—Ä–∞—Ü–∏—è –∏–ª–∏ –Ω–µ—Ç–æ—á–Ω—ã–π —Ä–µ–∑. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. –î–∏—Å–∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
2. –ü–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–π –¥–∏—Å–∫
3. –õ—é—Ñ—Ç –≤–∞–ª–∞', false, 'vibration_action'),

(2, 'vibration_action', '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:', false, NULL);

-- Terminal actions for miter saw
INSERT INTO fsm_steps (scenario_id, step_key, message, is_final, next_step_key) VALUES
(2, 'restore_power', 'üîå –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–¥–∞—á—É –ø–∏—Ç–∞–Ω–∏—è:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∏–ª–∫—É –∏ —Ä–æ–∑–µ—Ç–∫—É
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É–¥–ª–∏–Ω–∏—Ç–µ–ª—å (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º—É–ª—å—Ç–∏–º–µ—Ç—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≤—Ç–æ–º–∞—Ç –∑–∞—â–∏—Ç—ã

–£–±–µ–¥–∏—Ç–µ—Å—å –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.', true, NULL),

(2, 'replace_power_cable', 'üîå –ó–∞–º–µ–Ω–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –∫–∞–±–µ–ª—è:

1. –í–∏–∑—É–∞–ª—å–Ω—ã–π –æ—Å–º–æ—Ç—Ä –∫–∞–±–µ–ª—è –Ω–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è
2. –ü—Ä–æ–∑–≤–æ–Ω–∫–∞ –∫–∞–±–µ–ª—è –º—É–ª—å—Ç–∏–º–µ—Ç—Ä–æ–º
3. –ó–∞–º–µ–Ω–∞ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞
4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–æ–ª—è—Ü–∏–∏

–ß–∞—Å—Ç–æ –ø–æ–≤—Ä–µ–∂–¥–∞–µ—Ç—Å—è –≤ –º–µ—Å—Ç–µ –≤—Ö–æ–¥–∞ –≤ –∫–æ—Ä–ø—É—Å.', true, NULL),

(2, 'disable_safety_lock', 'üîí –û—Ç–∫–ª—é—á–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –ø—É—Å–∫–∞:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–µ–¥–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å–Ω—É—é –∫–Ω–æ–ø–∫—É
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–∏–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
3. –û–ø—É—Å—Ç–∏—Ç–µ –∑–∞—â–∏—Ç–Ω—ã–π –∫–æ–∂—É—Ö
4. –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ —Ä—É–∫–æ—è—Ç–∫—É

–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –∑–∞–ø—É—Å–∫.', true, NULL),

(2, 'repair_mechanical_drive', '‚öôÔ∏è –†–µ–º–æ–Ω—Ç –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–≤–æ–¥–∞:

1. –†–∞–∑–±–µ—Ä–∏—Ç–µ –ø—Ä–∏–≤–æ–¥–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º
2. –û—Å–º–æ—Ç—Ä–∏—Ç–µ —à–ø–∏–Ω–¥–µ–ª—å –∏ –ø–æ–¥—à–∏–ø–Ω–∏–∫–∏
3. –û—á–∏—Å—Ç–∏—Ç–µ –æ—Ç –æ–ø–∏–ª–æ–∫ –∏ –≥—Ä—è–∑–∏
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ

–†–µ–≥—É–ª—è—Ä–Ω–æ –æ—á–∏—â–∞–π—Ç–µ –æ—Ç –æ–ø–∏–ª–æ–∫.', true, NULL),

(2, 'replace_belt', 'üîß –ó–∞–º–µ–Ω–∞ —Ä–µ–º–Ω—è:

1. –†–∞–∑–±–µ—Ä–∏—Ç–µ –∑–∞—â–∏—Ç–Ω—ã–µ –∫–æ–∂—É—Ö–∏
2. –û—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–º–Ω—è
3. –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω–æ–≤—ã–π —Ä–µ–º–µ–Ω—å –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Ç—è–∂–µ–Ω–∏–µ

–†–µ–º–µ–Ω—å –ø–µ—Ä–µ–¥–∞–µ—Ç –≤—Ä–∞—â–µ–Ω–∏–µ –æ—Ç –º–æ—Ç–æ—Ä–∞ –∫ –¥–∏—Å–∫—É.', true, NULL),

(2, 'reinstall_blade', '‚öôÔ∏è –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–∏—Å–∫–∞:

1. –û—Ç–∫–ª—é—á–∏—Ç–µ –ø–∏—Ç–∞–Ω–∏–µ
2. –û—Å–ª–∞–±—å—Ç–µ –∫—Ä–µ–ø–µ–∂–Ω—É—é –≥–∞–π–∫—É
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Å–∞–¥–æ—á–Ω–æ–µ –æ—Ç–≤–µ—Ä—Å—Ç–∏–µ –¥–∏—Å–∫–∞
4. –ó–∞—Ç—è–Ω–∏—Ç–µ –≥–∞–π–∫—É —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –º–æ–º–µ–Ω—Ç–æ–º

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–ª—é—á –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞.', true, NULL),

(2, 'install_new_blade', 'üî™ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –¥–∏—Å–∫–∞:

1. –í—ã–±–µ—Ä–∏—Ç–µ –¥–∏—Å–∫ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –¥–∏–∞–º–µ—Ç—Ä–∞ –∏ —Ç–∏–ø–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ –ø–æ—Å–∞–¥–æ—á–Ω–æ–≥–æ –æ—Ç–≤–µ—Ä—Å—Ç–∏—è
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–µ–π –∑—É–±—å–µ–≤
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∏—Å–∫–∏.', true, NULL),

(2, 'repair_mechanical_drive_miter', '‚öôÔ∏è –†–µ–º–æ–Ω—Ç –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–æ–π —á–∞—Å—Ç–∏:

1. –û—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–∞–ª –∏ –ø–æ–¥—à–∏–ø–Ω–∏–∫–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª—é—Ñ—Ç –≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è—Ö
3. –ó–∞–º–µ–Ω–∏—Ç–µ –∏–∑–Ω–æ—à–µ–Ω–Ω—ã–µ –ø–æ–¥—à–∏–ø–Ω–∏–∫–∏
4. –û—Ç—Ä–µ–≥—É–ª–∏—Ä—É–π—Ç–µ –º–µ—Ö–∞–Ω–∏–∑–º

–ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —Ä–∞–∑–±–æ—Ä–∫–∞ –≤—Å–µ–≥–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞.', true, NULL);

-- –í—Å—Ç–∞–≤–∫–∞ —à–∞–≥–æ–≤ –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è "diagnose_jigsaw"
INSERT INTO fsm_steps (scenario_id, step_key, message, is_final, next_step_key) VALUES
-- Root state
(3, 'root', '–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —ç–ª–µ–∫—Ç—Ä–æ–ª–æ–±–∑–∏–∫–∞. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É:', false, NULL),

-- no_power branch
(3, 'no_power', '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. –ù–µ—Ç –ø–∏—Ç–∞–Ω–∏—è
2. –ù–µ–∏—Å–ø—Ä–∞–≤–Ω–∞ –∫–Ω–æ–ø–∫–∞
3. –û–±—Ä—ã–≤ –ø—Ä–æ–≤–æ–¥–∫–∏', false, 'no_power_action'),

(3, 'no_power_action', '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:', false, NULL),

-- blade_not_moving branch
(3, 'blade_not_moving', '–ü–æ–ª–æ—Ç–Ω–æ –Ω–µ –¥–≤–∏–∂–µ—Ç—Å—è. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. –ü–æ–ª–æ—Ç–Ω–æ –Ω–µ –∑–∞–∂–∞—Ç–æ
2. –ü–æ–ª–æ–º–∫–∞ —à—Ç–æ–∫–∞/–∫—Ä–∏–≤–æ—à–∏–ø–∞', false, 'blade_not_moving_action'),

(3, 'blade_not_moving_action', '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:', false, NULL),

-- excessive_vibration_or_drift branch
(3, 'excessive_vibration_or_drift', '–°–∏–ª—å–Ω–∞—è –≤–∏–±—Ä–∞—Ü–∏—è –∏–ª–∏ —É–≤–æ–¥. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. –¢—É–ø–æ–µ –ø–æ–ª–æ—Ç–Ω–æ
2. –ò–∑–Ω–æ—Å —Ä–æ–ª–∏–∫–æ–≤
3. –û—Å–ª–∞–±–ª–µ–Ω –∫–æ—Ä–ø—É—Å', false, 'vibration_drift_action'),

(3, 'vibration_drift_action', '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:', false, NULL);

-- Terminal actions for jigsaw
INSERT INTO fsm_steps (scenario_id, step_key, message, is_final, next_step_key) VALUES
(3, 'restore_power', 'üîå –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–¥–∞—á—É –ø–∏—Ç–∞–Ω–∏—è:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–æ–∑–µ—Ç–∫—É –∏ –∫–∞–±–µ–ª—å
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –£–ó–û/–∞–≤—Ç–æ–º–∞—Ç –∑–∞—â–∏—Ç—ã
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π –ø—Ä–∏–±–æ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–∑–µ—Ç–∫–∏

–£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–∏ —ç–ª–µ–∫—Ç—Ä–æ—Å–µ—Ç–∏.', true, NULL),

(3, 'replace_trigger_button', 'üîò –ó–∞–º–µ–Ω–∞ –∫–Ω–æ–ø–∫–∏ –ø—É—Å–∫–∞:

1. –†–∞–∑–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–ø—É—Å –ª–æ–±–∑–∏–∫–∞
2. –ò–∑–≤–ª–µ–∫–∏—Ç–µ —Å—Ç–∞—Ä—É—é –∫–Ω–æ–ø–∫—É
3. –û—á–∏—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –æ—Ç –ø—ã–ª–∏
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–æ–≤—É—é –∏–ª–∏ –æ—Ç—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É

–ß–∞—Å—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–æ—Å—Ç–∞—è —á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤.', true, NULL),

(3, 'repair_internal_wiring', 'üîå –†–µ–º–æ–Ω—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –ø—Ä–æ–≤–æ–¥–∫–∏:

1. –†–∞–∑–±–µ—Ä–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç
2. –ù–∞–π–¥–∏—Ç–µ –º–µ—Å—Ç–æ –æ–±—Ä—ã–≤–∞ (–æ–±—ã—á–Ω–æ —É —Ä–∞–∑—ä–µ–º–∞ –ø–∏—Ç–∞–Ω–∏—è)
3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–∞–π–∫–æ–π
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–∑–æ–ª—è—Ü–∏—é –≤—Å–µ—Ö –ø—Ä–æ–≤–æ–¥–æ–≤

–í–∏–±—Ä–∞—Ü–∏—è —á–∞—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –æ–±—Ä—ã–≤—ã –ø—Ä–æ–≤–æ–¥–∫–∏.', true, NULL),

(3, 'correctly_install_blade', 'üî™ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–ª–æ—Ç–Ω–∞:

1. –û—Ç–∫–ª—é—á–∏—Ç–µ –ø–∏—Ç–∞–Ω–∏–µ
2. –û—Å–ª–∞–±—å—Ç–µ –∑–∞–∂–∏–º –ø–æ–ª–æ—Ç–Ω–∞
3. –í—Å—Ç–∞–≤—å—Ç–µ –ø–æ–ª–æ—Ç–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω–æ–π
4. –ó–∞—Ç—è–Ω–∏—Ç–µ –∑–∞–∂–∏–º —Å –Ω—É–∂–Ω—ã–º —É—Å–∏–ª–∏–µ–º
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∏–∫—Å–∞—Ü–∏—é

–ü–æ–ª–æ—Ç–Ω–æ –¥–æ–ª–∂–Ω–æ –≤—Ö–æ–¥–∏—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ –Ω–æ –±–µ–∑ –ª—é—Ñ—Ç–∞.', true, NULL),

(3, 'repair_reciprocating_mechanism', '‚öôÔ∏è –†–µ–º–æ–Ω—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ –≤–æ–∑–≤—Ä–∞—Ç–Ω–æ-–ø–æ—Å—Ç—É–ø–∞—Ç–µ–ª—å–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è:

1. –†–∞–∑–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–ø—É—Å –∏ –º–µ—Ö–∞–Ω–∏–∑–º
2. –û—Å–º–æ—Ç—Ä–∏—Ç–µ —à—Ç–æ–∫ –∏ –∫—Ä–∏–≤–æ—à–∏–ø
3. –ó–∞–º–µ–Ω–∏—Ç–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ –¥–µ—Ç–∞–ª–∏
4. –°–æ–±–µ—Ä–∏—Ç–µ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É

–¢—Ä–µ–±—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏ –Ω–∞–≤—ã–∫–∏.', true, NULL),

(3, 'install_new_blade', 'üî™ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–ª–æ—Ç–Ω–∞:

1. –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª–æ—Ç–Ω–æ –ø–æ –º–∞—Ç–µ—Ä–∏–∞–ª—É –∏ —Ç–æ–ª—â–∏–Ω–µ
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Ç–∏–ø–∞ –∑–∞–∂–∏–º–∞
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —É–≥–ª–æ–º
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä—è–º–æ–ª–∏–Ω–µ–π–Ω–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è

–ö–∞–∂–¥—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª —Ç—Ä–µ–±—É–µ—Ç —Å–≤–æ–µ–≥–æ —Ç–∏–ø–∞ –ø–æ–ª–æ—Ç–Ω–∞.', true, NULL),

(3, 'repair_mechanical_drive', '‚öôÔ∏è –†–µ–º–æ–Ω—Ç –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–æ–π —á–∞—Å—Ç–∏:

1. –û—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª—è—é—â–∏–µ —Ä–æ–ª–∏–∫–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Ö –∏–∑–Ω–æ—Å –∏ –ª—é—Ñ—Ç
3. –ó–∞–º–µ–Ω–∏—Ç–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ —Ä–æ–ª–∏–∫–∏
4. –û—Ç—Ä–µ–≥—É–ª–∏—Ä—É–π—Ç–µ –º–µ—Ö–∞–Ω–∏–∑–º

–†–æ–ª–∏–∫–∏ –¥–æ–ª–∂–Ω—ã —Å–≤–æ–±–æ–¥–Ω–æ –≤—Ä–∞—â–∞—Ç—å—Å—è.', true, NULL),

(3, 'tighten_housing', 'üîß –ü–æ–¥—Ç—è–∂–∫–∞ –∫–æ—Ä–ø—É—Å–∞:

1. –û—Å–º–æ—Ç—Ä–∏—Ç–µ –≤—Å–µ –≤–∏–Ω—Ç—ã –∫—Ä–µ–ø–ª–µ–Ω–∏—è
2. –ü–æ–¥—Ç—è–Ω–∏—Ç–µ –æ—Å–ª–∞–±–ª–µ–Ω–Ω—ã–µ –≤–∏–Ω—Ç—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –∫–æ—Ä–ø—É—Å–∞
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –ø–æ—Å–ª–µ –ø–æ–¥—Ç—è–∂–∫–∏

–†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∑–∞—Ç—è–∂–∫—É –≤–∏–Ω—Ç–æ–≤.', true, NULL);

-- –í—Å—Ç–∞–≤–∫–∞ —à–∞–≥–æ–≤ –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è "diagnose_cordless_drill"
INSERT INTO fsm_steps (scenario_id, step_key, message, is_final, next_step_key) VALUES
-- Root state
(4, 'root', '–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–Ω–æ–≥–æ —à—É—Ä—É–ø–æ–≤—ë—Ä—Ç–∞. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É:', false, NULL),

-- no_power branch
(4, 'no_power', '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. –ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä —Ä–∞–∑—Ä—è–∂–µ–Ω
2. –ü–ª–æ—Ö–æ–π –∫–æ–Ω—Ç–∞–∫—Ç
3. –ù–µ–∏—Å–ø—Ä–∞–≤–Ω–∞ –∫–Ω–æ–ø–∫–∞', false, 'no_power_action'),

(4, 'no_power_action', '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:', false, NULL),

-- spins_but_no_torque branch
(4, 'spins_but_no_torque', '–í—Ä–∞—â–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –∫—Ä—É—Ç–∏—Ç. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. –ú—É—Ñ—Ç–∞ –º–æ–º–µ–Ω—Ç–∞ —Å—Ä–∞–±–æ—Ç–∞–ª–∞
2. –ò–∑–Ω–æ—Å —à–µ—Å—Ç–µ—Ä—ë–Ω', false, 'spins_no_torque_action'),

(4, 'spins_no_torque_action', '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:', false, NULL),

-- battery_drains_quickly branch
(4, 'battery_drains_quickly', '–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä –±—ã—Å—Ç—Ä–æ —Å–∞–¥–∏—Ç—Å—è. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. –î–µ–≥—Ä–∞–¥–∞—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
2. –ù–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç—å BMS', false, 'battery_drains_action'),

(4, 'battery_drains_action', '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:', false, NULL);

-- Terminal actions for cordless drill
INSERT INTO fsm_steps (scenario_id, step_key, message, is_final, next_step_key) VALUES
(4, 'charge_or_replace_battery', 'üîã –ó–∞—Ä—è–¥–∫–∞ –∏–ª–∏ –∑–∞–º–µ–Ω–∞ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–∞:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —É—Ä–æ–≤–Ω—è –∑–∞—Ä—è–¥–∞
2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫ –∑–∞—Ä—è–¥–Ω–æ–º—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–æ–ª–Ω–æ–π –∑–∞—Ä—è–¥–∫–∏
4. –ï—Å–ª–∏ –Ω–µ –∑–∞—Ä—è–∂–∞–µ—Ç—Å—è - –∑–∞–º–µ–Ω–∏—Ç–µ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä—ã.', true, NULL),

(4, 'service_contact_group', 'üîå –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–π –≥—Ä—É–ø–ø—ã:

1. –†–∞–∑–±–µ—Ä–∏—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–∞
2. –û—á–∏—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã –æ—Ç –æ–∫–∏—Å–ª–µ–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä—É–∂–∏–Ω–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã
4. –°–æ–±–µ—Ä–∏—Ç–µ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç

–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á–∏—Å—Ç—ã–º–∏ –∏ —É–ø—Ä—É–≥–∏–º–∏.', true, NULL),

(4, 'replace_trigger_button', 'üîò –ó–∞–º–µ–Ω–∞ –∫–Ω–æ–ø–∫–∏ –ø—É—Å–∫–∞:

1. –†–∞–∑–±–µ—Ä–∏—Ç–µ –∫–æ—Ä–ø—É—Å
2. –ò–∑–≤–ª–µ–∫–∏—Ç–µ –∫–Ω–æ–ø–∫—É —Ä–µ–≤–µ—Ä—Å–∞/–ø—É—Å–∫–∞
3. –û—á–∏—Å—Ç–∏—Ç–µ –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç–µ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É

–ß–∞—Å—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç —á–∏—Å—Ç–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤.', true, NULL),

(4, 'adjust_torque_setting', '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫—Ä—É—Ç—è—â–µ–≥–æ –º–æ–º–µ–Ω—Ç–∞:

1. –ù–∞–π–¥–∏—Ç–µ –∫–æ–ª—å—Ü–æ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∫–∏ –º–æ–º–µ–Ω—Ç–∞
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–∏–π –Ω–æ–º–µ—Ä
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞—Ç—è–Ω—É—Ç—å –∫—Ä–µ–ø–µ–∂
4. –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –º—É—Ñ—Ç—É

–ú—É—Ñ—Ç–∞ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏.', true, NULL),

(4, 'repair_gearbox', '‚öôÔ∏è –†–µ–º–æ–Ω—Ç —Ä–µ–¥—É–∫—Ç–æ—Ä–∞:

1. –†–∞–∑–±–µ—Ä–∏—Ç–µ —Ä–µ–¥—É–∫—Ç–æ—Ä
2. –û—Å–º–æ—Ç—Ä–∏—Ç–µ —à–µ—Å—Ç–µ—Ä–Ω–∏ –Ω–∞ –∏–∑–Ω–æ—Å
3. –ó–∞–º–µ–Ω–∏—Ç–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–µ —à–µ—Å—Ç–µ—Ä–Ω–∏
4. –°–º–∞–∂—å—Ç–µ –º–µ—Ö–∞–Ω–∏–∑–º

–ß–∞—Å—Ç–æ –∏–∑–Ω–∞—à–∏–≤–∞—é—Ç—Å—è –ø–ª–∞—Å—Ç–∏–∫–æ–≤—ã–µ —à–µ—Å—Ç–µ—Ä–Ω–∏.', true, NULL),

(4, 'replace_battery_cells', 'üîã –ó–∞–º–µ–Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–∞:

1. –†–∞–∑–±–µ—Ä–∏—Ç–µ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä
2. –ò–∑–º–µ—Ä—å—Ç–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–π —è—á–µ–π–∫–µ
3. –ó–∞–º–µ–Ω–∏—Ç–µ —Å–ª–∞–±—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
4. –°–æ–±–µ—Ä–∏—Ç–µ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ

–¢—Ä–µ–±—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ.', true, NULL),

(4, 'refer_to_service_center', 'üè™ –û–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Ü–µ–Ω—Ç—Ä:

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
- –ù–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–∏ BMS
- –°–ª–æ–∂–Ω—ã—Ö —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º
- –ó–∞–º–µ–Ω—ã —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä–∞

BMS –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –∑–∞—Ä—è–¥/—Ä–∞–∑—Ä—è–¥ –±–∞—Ç–∞—Ä–µ–∏.', true, NULL);

-- –í—Å—Ç–∞–≤–∫–∞ —à–∞–≥–æ–≤ –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è "diagnose_corded_lawnmower"
INSERT INTO fsm_steps (scenario_id, step_key, message, is_final, next_step_key) VALUES
-- Root state
(5, 'root', '–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–≤–æ–¥–Ω–æ–π –≥–∞–∑–æ–Ω–æ–∫–æ—Å–∏–ª–∫–∏. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É:', false, NULL),

-- no_power branch
(5, 'no_power', '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. –ù–µ—Ç –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è
2. –û–±—Ä—ã–≤ –∫–∞–±–µ–ª—è
3. –°—Ä–∞–±–æ—Ç–∞–ª–∞ —Ç–µ—Ä–º–æ–∑–∞—â–∏—Ç–∞', false, 'no_power_action'),

(5, 'no_power_action', '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:', false, NULL),

-- motor_runs_no_blade_rotation branch
(5, 'motor_runs_no_blade_rotation', '–ú–æ—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ –Ω–æ–∂ –Ω–µ –≤—Ä–∞—â–∞–µ—Ç—Å—è. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. –ù–æ–∂ –∑–∞–∫–ª–∏–Ω–∏–ª–æ
2. –û–±—Ä—ã–≤ —Ä–µ–º–Ω—è
3. –ò–∑–Ω–æ—Å –ø–æ–¥—à–∏–ø–Ω–∏–∫–æ–≤', false, 'motor_no_blade_action'),

(5, 'motor_no_blade_action', '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:', false, NULL),

-- uneven_cut_or_vibration branch
(5, 'uneven_cut_or_vibration', '–ù–µ—Ä–æ–≤–Ω—ã–π —Å—Ä–µ–∑ –∏–ª–∏ –≤–∏–±—Ä–∞—Ü–∏—è. –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

1. –¢—É–ø–æ–π –Ω–æ–∂
2. –î–∏—Å–±–∞–ª–∞–Ω—Å –Ω–æ–∂–∞
3. –ù–µ—Ä–∞–≤–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –∫–æ–ª—ë—Å', false, 'uneven_cut_action'),

(5, 'uneven_cut_action', '–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:', false, NULL);

-- Terminal actions for corded lawnmower
INSERT INTO fsm_steps (scenario_id, step_key, message, is_final, next_step_key) VALUES
(5, 'restore_power', 'üîå –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–¥–∞—á—É –ø–∏—Ç–∞–Ω–∏—è:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–æ–∑–µ—Ç–∫—É –º—É–ª—å—Ç–∏–º–µ—Ç—Ä–æ–º
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –£–ó–û/–∞–≤—Ç–æ–º–∞—Ç –∑–∞—â–∏—Ç—ã
3. –û—Å–º–æ—Ç—Ä–∏—Ç–µ –∫–∞–±–µ–ª—å –Ω–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

–£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–∏ —ç–ª–µ–∫—Ç—Ä–æ—Å–µ—Ç–∏.', true, NULL),

(5, 'replace_power_cable', 'üîå –ó–∞–º–µ–Ω–∞ —Å–µ—Ç–µ–≤–æ–≥–æ –∫–∞–±–µ–ª—è:

1. –û—Ç–∫–ª—é—á–∏—Ç–µ –æ—Ç —Å–µ—Ç–∏
2. –û—Å–º–æ—Ç—Ä–∏—Ç–µ –∫–∞–±–µ–ª—å –Ω–∞ –ø–µ—Ä–µ–≥–∏–±—ã –∏ –ø–µ—Ä–µ—Ç–∏—Ä–∞–Ω–∏—è
3. –ü—Ä–æ–∑–≤–æ–Ω–∏—Ç–µ –∫–∞–±–µ–ª—å
4. –ó–∞–º–µ–Ω–∏—Ç–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω—ã–π —É—á–∞—Å—Ç–æ–∫

–ö–∞–±–µ–ª—å —á–∞—Å—Ç–æ –ø–æ–≤—Ä–µ–∂–¥–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ.', true, NULL),

(5, 'restart_after_cooling', '‚ùÑÔ∏è –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏—è:

1. –û—Ç–∫–ª—é—á–∏—Ç–µ –∫–æ—Å–∏–ª–∫—É –æ—Ç —Å–µ—Ç–∏
2. –î–∞–π—Ç–µ –æ—Å—Ç—ã—Ç—å 20-30 –º–∏–Ω—É—Ç
3. –û—á–∏—Å—Ç–∏—Ç–µ –æ—Ç —Ç—Ä–∞–≤—ã –∏ –≥—Ä—è–∑–∏
4. –ü–æ–≤—Ç–æ—Ä–Ω–æ –≤–∫–ª—é—á–∏—Ç–µ

–¢–µ—Ä–º–æ–∑–∞—â–∏—Ç–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –ø–µ—Ä–µ–≥—Ä–µ–≤–µ.', true, NULL),

(5, 'clear_working_area', 'üå± –û—á–∏—Å—Ç–∫–∞ —Ä–∞–±–æ—á–µ–π –∑–æ–Ω—ã:

1. –û—Ç–∫–ª—é—á–∏—Ç–µ –æ—Ç —Å–µ—Ç–∏
2. –û—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–æ–∂ –∏ –∑–∞—â–∏—Ç–Ω—ã–π –∫–æ–∂—É—Ö
3. –£–¥–∞–ª–∏—Ç–µ –Ω–∞–º–æ—Ç–∞–≤—à—É—é—Å—è —Ç—Ä–∞–≤—É, –≤–µ—Ç–∫–∏, –∫–∞–º–Ω–∏
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ –Ω–æ–∂–∞

–†–µ–≥—É–ª—è—Ä–Ω–æ –æ—á–∏—â–∞–π—Ç–µ –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã.', true, NULL),

(5, 'replace_belt', 'üîß –ó–∞–º–µ–Ω–∞ —Ä–µ–º–Ω—è:

1. –†–∞–∑–±–µ—Ä–∏—Ç–µ –∑–∞—â–∏—Ç–Ω—ã–µ –∫–æ–∂—É—Ö–∏
2. –û—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–º–Ω—è
3. –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω–æ–≤—ã–π —Ä–µ–º–µ–Ω—å
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Ç—è–∂–µ–Ω–∏–µ

–†–µ–º–µ–Ω—å –ø–µ—Ä–µ–¥–∞–µ—Ç –≤—Ä–∞—â–µ–Ω–∏–µ –æ—Ç –º–æ—Ç–æ—Ä–∞ –∫ –Ω–æ–∂—É.', true, NULL),

(5, 'repair_mechanical_drive', '‚öôÔ∏è –†–µ–º–æ–Ω—Ç –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–æ–π —á–∞—Å—Ç–∏:

1. –û—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–¥—à–∏–ø–Ω–∏–∫–∏ –≤–∞–ª–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–∞—â–µ–Ω–∏–µ
3. –ó–∞–º–µ–Ω–∏—Ç–µ –∏–∑–Ω–æ—à–µ–Ω–Ω—ã–µ –ø–æ–¥—à–∏–ø–Ω–∏–∫–∏
4. –°–º–∞–∂—å—Ç–µ –º–µ—Ö–∞–Ω–∏–∑–º

–ü–æ–¥—à–∏–ø–Ω–∏–∫–∏ —Ç—Ä–µ–±—É—é—Ç —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è.', true, NULL),

(5, 'sharpen_or_replace_blade', 'üî™ –ó–∞—Ç–æ—á–∫–∞ –∏–ª–∏ –∑–∞–º–µ–Ω–∞ –Ω–æ–∂–∞:

1. –û—Ç–∫–ª—é—á–∏—Ç–µ –æ—Ç —Å–µ—Ç–∏
2. –°–Ω–∏–º–∏—Ç–µ –Ω–æ–∂
3. –ó–∞—Ç–æ—á–∏—Ç–µ –Ω–æ–∂ –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –Ω–æ–≤—ã–π
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º

–¢—É–ø–æ–π –Ω–æ–∂ —Ä–≤–µ—Ç —Ç—Ä–∞–≤—É –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–∏–∂–∫–∏.', true, NULL),

(5, 'correctly_install_blade', '‚öñÔ∏è –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–∂–∞:

1. –°–Ω–∏–º–∏—Ç–µ –Ω–æ–∂
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –Ω–∞ –ø–∞–ª—å—Ü–µ
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –º–æ–º–µ–Ω—Ç–æ–º –∑–∞—Ç—è–∂–∫–∏
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∏–±—Ä–∞—Ü–∏–∏

–ù–æ–∂ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω.', true, NULL),

(5, 'adjust_cutting_height', 'üìè –†–µ–≥—É–ª–∏—Ä–æ–≤–∫–∞ –≤—ã—Å–æ—Ç—ã –∫–æ—à–µ–Ω–∏—è:

1. –û—Å–º–æ—Ç—Ä–∏—Ç–µ –∫–æ–ª–µ—Å–∏–∫–∏
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –≤—ã—Å–æ—Ç—É –≤—Å–µ—Ö –∫–æ–ª–µ—Å
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É –Ω–∞ —Ä–æ–≤–Ω–æ–π –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏
4. –û—Ç—Ä–µ–≥—É–ª–∏—Ä—É–π—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

–ö–æ–ª–µ—Å–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ.', true, NULL);

-- –í—Å—Ç–∞–≤–∫–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
UPDATE settings
SET trigger_message_count = 4,
    site_url = COALESCE(site_url, 'https://example.com'),
    updated_at = NOW()
WHERE id = 1
AND (trigger_message_count IS NULL OR trigger_message_count = 0 OR trigger_message_count != 4);

-- –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ —Å id=1 –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –≤—Å—Ç–∞–≤–ª—è–µ–º –µ—ë
INSERT INTO settings (id, trigger_message_count, site_url, updated_at)
VALUES (1, 4, 'https://example.com', NOW())
ON CONFLICT (id) DO NOTHING;
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```env
# Telegram Bot
TELEGRAM_BOT_TOKEN=your_bot_token_here

# Database
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=postgres
DB_NAME=electro_tools_bot
DB_SSLMODE=disable

# HTTP API
HTTP_PORT=8080
ADMIN_API_TOKEN=your_secret_admin_token_here

# Settings
DEFAULT_SITE_URL=https://example.com
RATE_LIMIT_PER_MINUTE=10
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
go test ./... -v -cover
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞
–¶–µ–ª—å: ‚â•70% –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ FSM –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è email
- –õ–æ–≥–∏–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–∞ —Å—Å—ã–ª–∫–∏
- Rate limiting

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏ Prometheus
```bash
curl http://localhost:8080/api/v1/metrics
```

### Health check
```bash
curl http://localhost:8080/health
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- **Rate limiting** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É
- **Input validation** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **SQL injection protection** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ prepared statements
- **Bearer token authentication** - –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ API